@using StudentTracking.Models.Domain;
@using StudentTracking.Models.Domain.Misc;
@using StudentTracking.Models.Domain.Address;
@using Utilities;
@model StudentTracking.Models.Domain.StudentModel
@{
    ViewData["Title"] = "Студент";
}
<div class="container">
    <div class="row">
        <label for="GradeBookNumber" class="col-2">Номер зачетки</label>
        <input id="GradeBookNumber" class="col-2" value="@Model.GradeBookNumber"/>
        <div id = "GradeBookNumber_err"></div>
    </div>
    <div class="row">
        <label for="Snils" class="col-2">Снилс</label>
        <input id="Snils" class="col-2" value="@Model.Snils"/>
        <div id = "Snils_err"></div>
    </div>
    <div div class="row" >
        <label for="Inn" class="col-2">Инн</label>
        <input id="Inn" class="col-2" value="@Model.Inn"/>
        <div id = "Inn_err"></div>
    </div>
    
    <div>
        <label for="DateOfBirth" class="col-2">Дата Рождения</label>
        <input id="DateOfBirth" class="col-2" value="@Model.DateOfBirth"/>
        <div id = "DateOfBirth_err"></div>
    </div>
    
    <div class="row">
        <label for="Gender" class="col-2">Пол</label>
        <select id="Gender" class="col-2" hint = "@Model.Gender" >
                @foreach(var g in StudentTracking.Models.Domain.Misc.Genders.Names){
                    var code = (int)g.Key;
                    <option value="@code">@g.Value</option>
                }
        </select>
    </div>

    <div class="row">
        <label for="TargetAgreementType" class="col-2">Договор о целевом обучении</label>
        <select id="TargetAgreementType" class="col-2" hint = "@Model.TargetAgreementType" >
                @foreach(var g in StudentTracking.Models.Domain.Misc.TargetEduAgreement.Names){
                    var code = (int)g.Key;
                    <option value="@code">@g.Value</option>
                }
        </select>
    </div>
    <div class="row">
        <label for="PaidAgreementType" class="col-2">Договор об обучении на платной основе</label>
        <select id="PaidAgreementType" class="col-2" hint = "@Model.PaidAgreementType" >
                @foreach(var g in StudentTracking.Models.Domain.Misc.PaidEduAgreement.Names){
                    var code = (int)g.Key;
                    <option value="@code">@g.Value</option>
                }
        </select>
    </div>
    <div>
        <label for="AdmissionScore">Вступительный балл</label>
         <input id="AdmissionScore" class="col-2" value="@Model.AdmissionScore"/>
         <div id = "AdmissionScore_err"></div>
    </div>
    <div>
        <label for="GiaMark" class=>Балл ГИА</label>
        <input id="GiaMark" class="col-2" value="@Model.GiaMark"/>
        <div id = "GiaMark_err"></div>
    </div>
    <div>
        <label for="GiaDemoExamMark">Балл ГИА (демэкзамен)</label>
        <input id="GiaDemoExamMark" class="col-2" value="@Model.GiaDemoExamMark"/>
        <div id = "GiaDemoExamMark_err"></div>
    </div>
    <div>
        @{
            string RealAddress = "";
            if (Model.ActualAddressId!=null){
                RealAddress = (await AddressModel.GetAddressById((int)Model.ActualAddressId))?.FullAddressString ?? "";
            }
        }
        <label for="ActualAddress">Адрес</label>
        <input id="ActualAddress" class="col-8" value="@RealAddress"/>
        <button id = "about" class = "col-1">Разобрать</button>
        <div id = "ActualAddress_err"></div>
        <div id = "AboutAddress"></div>
    </div>
    @{
        RussianCitizenship? citizenship = Model.RussianCitizenshipId == null ? null : await RussianCitizenship.GetById((int)Model.RussianCitizenshipId);
        AddressModel? address = await AddressModel.GetAddressById(citizenship?.LegalAddressId ?? Utils.INVALID_ID);
        string LegalAddress = address?.FullAddressString ?? ""; 
    }
    else{
        <div>
            <h2>Гражданство (РФ)</h2>
            <input type="hidden"/>
            <div class="d-flex flex-row">
                <h5 class="col-3">Фамилия</h5>
                @if (citizenship == null){
                    <input id="Surname"class="col-3"/>
                } else {
                    <input id="Surname"class="col-3" value="@citizenship.Surname"/>
                }
            </div>
            <div id="Surname_err"></div>
            <div class="d-flex flex-row">
                <h5 class="col-3">Имя</h5>
                @if (citizenship == null){
                    <input id="Name"class="col-3"/>
                } else {
                    <input id="Name"class="col-3" value="@citizenship.Name"/>
                }
            </div>
            <div id="Name_err"></div>
            <div class="d-flex flex-row">
                <h5 class="col-3">Отчество</h5>
                @if (citizenship == null){
                    <input id="Patronymic"class="col-3"/>
                } else {
                    <input id="Patronymic"class="col-3" value="@citizenship.Patronymic"/>
                }
            </div>
            <div id="Patronymic_err"></div>
            <div class="d-flex flex-row">
                <h5 class="col-3">Номер паспорта</h5>
                @if (citizenship == null){
                    <input id="PassportNumber"class="col-3"/>
                } else {
                    <input id="PassportNumber"class="col-3" value="@citizenship.Patronymic"/>
                }
            </div>
            <div id="PassportNumber_err"></div>
            <div class="d-flex flex-row">
                <h5 class="col-3">Серия паспорта</h5>
                @if (citizenship == null){
                    <input id="PassportSeries"class="col-3"/>
                } else {
                    <input id="PassportSeries"class="col-3" value="@citizenship.Patronymic"/>
                }
            </div>
            <div id="PassportSeries_err"></div>
            <div class="d-flex flex-row">
                <h5 class="col-3">Прописка</h5>
                @if (citizenship == null){
                    <input id="LegalAddress"class="col-9"/>
                } else {
                    <input id="LegalAddress"class="col-9" value="@LegalAddress"/>
                }
                <button class="col-1" id ="about_legal_address">
                    Проверить
                </button>
            </div>
            <div id=  "LegalAddress_err"></div>
            <div id = "legal_address_info"></div>
            <div id = "legal_address_err"></div>
        </div>

    </div>
    <button id="save">
        Сохранить
    </button>

    @{
        string corrRusId = citizenship?.Id.ToString() ?? "";
        string corrRusAddress = citizenship?.LegalAddressId.ToString() ?? "";
    }

    <input type="hidden" id="StudentId" value="@Model.Id"/>
    <input type="hidden" id="AddressId" value="@Model.ActualAddressId"/>
    <input type="hidden" id="RussianLegalAddressId" value="@corrRusAddress"/>
    <input type="hidden" id="RussianCitizenshipId" value="@corrRusId"/>    
</div>

<script src="~/js/students.js"></script>


